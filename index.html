<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- URGENT: Force cache refresh with timestamp -->
    <!-- Version: 2025.07.15.2000 - LANGUAGES: English and Swedish only -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-buster" content="1900-removed-title-screen">
    <meta name="last-modified" content="2025-07-15T18:00:00Z">
    <!-- Content Security Policy for enhanced security -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://fonts.googleapis.com https://fonts.gstatic.com https://unpkg.com; img-src 'self' data:; font-src 'self' https://fonts.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com; worker-src 'self' blob:; connect-src 'self' https:;">
    <title>SYNAPSE</title>
    <link rel="icon" type="image/png" href="./Icon.png">
    <script>
        // CRITICAL: Force cache invalidation for GitHub Pages
        console.log('ðŸ”¥ CACHE BUSTER: 2025.07.15.1730 - Forcing browser refresh');
        
        // Add timestamp to URL parameters to force refresh
        if (window.location.search === '' && window.location.hash === '') {
            const timestamp = new Date().getTime();
            window.history.replaceState({}, document.title, window.location.pathname + '?cb=' + timestamp);
        }
        
        // Only load manifest on HTTP/HTTPS protocols to avoid CORS errors
        if (window.location.protocol !== 'file:') {
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = './manifest.json?cb=' + new Date().getTime();
            document.head.appendChild(manifestLink);
        }
        
        // Cache control and manifest loading
        if (window.location.protocol !== 'file:') {
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = './manifest.json?cb=' + new Date().getTime();
            document.head.appendChild(manifestLink);
        }
    </script>
    
    <!-- Local Tailwind CSS - No CDN dependency -->
    <script>
        // Note: Removed CDN dependency - using comprehensive fallback styles instead
        console.log('Using local fallback styles instead of Tailwind CDN for reliability');
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=VT323&family=Space+Mono&family=Courier+Prime&display=swap" rel="stylesheet" onerror="console.error('Failed to load Google Fonts')">
    
    <!-- Conditional loading for Tone.js -->
    <script>
        // Load Tone.js only if not running from file protocol
        if (window.location.protocol !== 'file:') {
            const toneScript = document.createElement('script');
            toneScript.src = 'https://unpkg.com/tone@15.0.4/build/Tone.js';
            toneScript.crossOrigin = 'anonymous';
            toneScript.onerror = function() {
                console.warn('Tone.js failed to load - audio features disabled');
            };
            document.head.appendChild(toneScript);
    } else {
        console.log('Running from file:// - Tone.js skipped to avoid CORS issues');
    }
</script>
<style>
    /* Enhanced Responsive Design & PWA Styles */
        
        /* Extra small screens custom breakpoint */
        @media (max-width: 475px) {
            .xs\:text-5xl { font-size: 3rem; }
            .xs\:text-base { font-size: 1rem; }
        }
        
        /* Mobile-first responsive design */
        @media (max-width: 640px) {
            .mobile-stack { flex-direction: column !important; }
            .mobile-full { width: 100% !important; }
            .mobile-text-sm { font-size: 0.875rem !important; }
            .mobile-px-2 { padding-left: 0.5rem !important; padding-right: 0.5rem !important; }
            .mobile-gap-3 { gap: 0.75rem !important; }
        }
        
        /* Landscape mobile optimization */
        @media (max-height: 500px) and (orientation: landscape) {
            .landscape-compact .title-wrapper { margin-bottom: 1rem !important; }
            .landscape-compact h1 { font-size: 2.5rem !important; }
            .landscape-compact h2 { font-size: 1rem !important; }
            .landscape-compact #intro-text-container { margin-top: 0.5rem !important; margin-bottom: 0.5rem !important; }
            .landscape-compact #start-options { margin-top: 1rem !important; }
        }
        
        /* Safe area support for devices with notches */
        .safe-area-top { padding-top: env(safe-area-inset-top); }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-area-left { padding-left: env(safe-area-inset-left); }
        .safe-area-right { padding-right: env(safe-area-inset-right); }
        
        /* PWA specific styles */
        .pwa-hidden { display: none !important; }
        .pwa-installing { opacity: 0.5; pointer-events: none; }
        
        /* Enhanced touch targets for mobile */
        @media (pointer: coarse) {
            .button {
                min-height: 44px !important;
                min-width: 44px !important;
                touch-action: manipulation;
            }
        }
        
        /* Fallback styles when Tailwind CSS is not available */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .text-center { text-align: center; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .top-2 { top: 0.5rem; }
        .top-4 { top: 1rem; }
        .bottom-2 { bottom: 0.5rem; }
        .bottom-4 { bottom: 1rem; }
        .left-2 { left: 0.5rem; }
        .left-4 { left: 1rem; }
        .right-2 { right: 0.5rem; }
        .right-4 { right: 1rem; }
        .z-30 { z-index: 30; }
        .hidden { display: none !important; }
        .min-h-screen { min-height: 100vh; }
        .overflow-hidden { overflow: hidden; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .whitespace-nowrap { white-space: nowrap; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-4xl { font-size: 2.25rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-6 { gap: 1.5rem; }
        .max-w-xs { max-width: 20rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-6xl { max-width: 72rem; }
        .max-w-4xl { max-width: 56rem; }
        .text-6xl { font-size: 3.75rem; line-height: 1; }
        .text-7xl { font-size: 4.5rem; line-height: 1; }
        .text-8xl { font-size: 6rem; line-height: 1; }
        .text-9xl { font-size: 8rem; line-height: 1; }
        .text-lg { font-size: 1.125rem; line-height: 1.75; }
        .text-xl { font-size: 1.25rem; line-height: 1.75; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .text-5xl { font-size: 3rem; line-height: 1; }
        .text-6xl { font-size: 3.75rem; line-height: 1; }
        .text-7xl { font-size: 4.5rem; line-height: 1; }
        .text-8xl { font-size: 6rem; line-height: 1; }
        .leading-none { line-height: 1; }
        .leading-tight { line-height: 1.25; }
        
        /* Custom extra large text sizes */
        @media (min-width: 1024px) {
            .lg-text-10rem { font-size: 10rem; line-height: 1; }
        }
        @media (min-width: 1280px) {
            .xl-text-12rem { font-size: 12rem; line-height: 1; }
        }
        @media (min-width: 1536px) {
            .xxl-text-14rem { font-size: 14rem; line-height: 1; }
        }
        .font-bold { font-weight: 700; }
        .font-mono { font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        .leading-relaxed { line-height: 1.625; }
        .tracking-wider { letter-spacing: 0.05em; }
        .text-green-400 { color: rgb(74 222 128); }
        .text-red-500 { color: rgb(239 68 68); }
        .text-gray-200 { color: rgb(229 231 235); }
        .bg-black { background-color: rgb(0 0 0); }
        .bg-green-500\/20 { background-color: rgb(34 197 94 / 0.2); }
        .bg-green-600\/20 { background-color: rgb(22 163 74 / 0.2); }
        .bg-green-600\/10 { background-color: rgb(22 163 74 / 0.1); }
        .bg-blue-600\/20 { background-color: rgb(37 99 235 / 0.2); }
        .bg-cyan-600\/20 { background-color: rgb(8 145 178 / 0.2); }
        .bg-amber-500\/20 { background-color: rgb(245 158 11 / 0.2); }
        .border-green-400 { border-color: rgb(74 222 128); }
        .border-green-400\/50 { border-color: rgb(74 222 128 / 0.5); }
        .border-blue-400 { border-color: rgb(96 165 250); }
        .border-cyan-400 { border-color: rgb(34 211 238); }
        .border-amber-400 { border-color: rgb(251 191 36); }
        .text-blue-400 { color: rgb(96 165 250); }
        .text-cyan-400 { color: rgb(34 211 238); }
        .text-amber-400 { color: rgb(251 191 36); }
        .opacity-50 { opacity: 0.5; }
        .bg-opacity-60 { background-color: rgba(0, 0, 0, 0.6); }
        .hover\:bg-green-500\/30:hover { background-color: rgb(34 197 94 / 0.3); }
        .hover\:bg-amber-500\/30:hover { background-color: rgb(245 158 11 / 0.3); }
        .rounded-lg { border-radius: 0.5rem; }
        .border { border-width: 1px; }
        .border-green-500\/30 { border-color: rgb(34 197 94 / 0.3); }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); }
        .bg-black\/90 { background-color: rgb(0 0 0 / 0.9); }
        .p-4 { padding: 1rem; }
        .flex-wrap { flex-wrap: wrap; }
        
        @media (min-width: 768px) {
            .md\:text-9xl { font-size: 8rem; }
            .md\:text-4xl { font-size: 2.25rem; }
            .md\:text-lg { font-size: 1.125rem; }
        }
        
        :root {
            --main-color: #00ff41;
            --main-color-faded: rgba(0,255,65,0.1);
            --main-color-border: rgba(0,255,65,0.8);
            --main-color-shadow: rgba(0,255,65,0.5);
            --main-color-glow: rgba(0,255,65,0.7);
        }
        /* Enhanced responsive design with simplified background */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; 
            font-size: clamp(14px, 1.5vw, 18px);
        }
        
        body {
            background-color: #0d0d0d;
            color: var(--main-color);
            font-family: 'Space Mono', monospace;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            min-height: 100vh;
            min-height: 100dvh;
            overflow: hidden;
            /* Simplified background image */
            background-image: url('./Icon.png') !important;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            background-attachment: fixed !important;
        }
        
        /* Ensure html also takes full space */
        html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        /* Handle viewport changes gracefully */
        * {
            box-sizing: border-box;
        }
        
        /* App container with semi-transparent background */
        #app-container {
            background: rgba(0,0,0,0.85) !important;
            backdrop-filter: blur(1px);
            pointer-events: auto !important;
        }
        
        /* Ensure content screens have proper backgrounds */
        #start-screen, #player-setup, #prologue-screen {
            background: rgba(0,0,0,0.7) !important;
            color: var(--main-color) !important;
        }
        
        /* Ensure all text elements are visible */
        #start-screen *, #player-setup *, #prologue-screen * {
            color: inherit !important;
        }
        
        /* Ensure all buttons are clickable and visible */
        button, .button, input[type="button"] {
            pointer-events: auto !important;
            position: relative !important;
            z-index: 200 !important;
        }
        
        /* Ensure titles are highly visible */
        .title-slasher, .subtitle-slasher {
            position: relative !important;
            z-index: 100 !important;
            color: #00ff41 !important;
        }
        
        .title-slasher {
            color: #39FF14 !important;
        }
        
        .subtitle-slasher {
            color: #ff3333 !important;
        }
        
        /* Ensure buttons are visible */
        .button {
            position: relative !important;
            z-index: 50 !important;
            background: var(--main-color-faded) !important;
            color: var(--main-color) !important;
        }
        
        /* Ensure game description text is visible */
        #intro-text-container {
            color: #e5e7eb !important;
            background: rgba(0,0,0,0.5) !important;
            padding: 1rem !important;
            border-radius: 0.5rem !important;
        }
        
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            width: 100vw;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height */
            z-index: 0;
            opacity: 0.1;
        }
        
        #app-container, .app-container-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height */
            max-width: 100vw;
            max-height: 100vh;
            max-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: stretch;
            z-index: 10;
            overflow: hidden;
            box-sizing: border-box;
            padding: clamp(8px, 2vw, 16px);
            pointer-events: auto !important;
        }
        
        /* Enhanced responsive container that adapts to all screen sizes */
        @media (min-width: 640px) {
            #app-container {
                max-width: min(95vw, 1200px);
                max-height: min(95vh, 800px);
                margin: auto;
                border-radius: 0.5rem;
                border: 1px solid rgba(0,255,65,0.3);
                background: rgba(0,0,0,0.9);
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: auto;
                height: auto;
            }
        }
        
        /* Ultra-wide screen optimization */
        @media (min-width: 1920px) {
            #app-container {
                max-width: 1400px;
                max-height: 900px;
            }
        }
        
        /* Very small screen optimization */
        @media (max-width: 480px) {
            #app-container {
                padding: clamp(4px, 1vw, 8px);
            }
        }
        
        /* Landscape mobile specific adjustments */
        @media (max-height: 500px) and (orientation: landscape) {
            #app-container {
                padding: 4px;
            }
            
            .landscape-compact .title-wrapper { 
                margin-bottom: 0.5rem !important; 
            }
            
            .landscape-compact h1 { 
                font-size: clamp(1.5rem, 8vw, 3rem) !important; 
            }
            
            .landscape-compact h2 { 
                font-size: clamp(0.75rem, 4vw, 1.25rem) !important; 
            }
        }
        
        /* Ensure game elements don't exceed container bounds */
        .game-interface, #game-screen {
            max-height: inherit;
            overflow: auto;
            width: 100%;
            box-sizing: border-box;
        }
        
        #game-output {
            max-height: 60vh;
            max-height: 60dvh;
            overflow-y: auto;
        }
        body.crt-effect::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: rgba(18, 16, 16, 0.1);
            opacity: .5;
            z-index: 2;
            pointer-events: none;
            background: repeating-linear-gradient(0deg, rgba(0, 255, 65, 0.15), rgba(0, 255, 65, 0.15) 1px, transparent 1px, transparent 2px);
        }
        .title-font {
            font-family: 'VT323', monospace;
        }

        .title-wrapper {
            position: relative;
        }
        
        /* Main green text layer */
        .title-slasher {
            font-family: 'Creepster', cursive;
            color: #39FF14;
            letter-spacing: 0.1em;
            position: relative;
            z-index: 2; 
            /* Original green text glow */
            text-shadow: 
                0 0 5px #39FF14, 
                0 0 10px #39FF14;
        }

        /* The blood layer behind the text */
        .title-slasher::before {
            content: attr(data-text);
            position: absolute;
            left: 0;
            top: 0;
            color: transparent; 
            z-index: 1; 
            animation: liquid-drip-back 8s infinite ease-out;
            filter: 
                drop-shadow(0 0 3px #8B0000) 
                drop-shadow(0 0 8px #B22222) 
                drop-shadow(0 0 15px #DC143C)
                drop-shadow(0 0 25px #FF6347);
        }

        /* The blood layer in front of the text */
        .title-slasher::after {
            content: attr(data-text);
            position: absolute;
            left: 0;
            top: 0;
            color: transparent; 
            z-index: 3; 
            animation: liquid-drip-front 8s infinite ease-out 2s;
            filter: 
                drop-shadow(0 0 3px #8B0000) 
                drop-shadow(0 0 8px #B22222) 
                drop-shadow(0 0 15px #DC143C)
                drop-shadow(0 0 25px #FF6347);
            opacity: 0.8;
        }

        @keyframes liquid-drip-back {
            0% { 
                text-shadow: 
                    0px 0px 0px #8B0000,
                    1px 1px 0px #8B0000,
                    2px 2px 0px #8B0000,
                    0 0 3px #B22222,
                    0 0 6px #DC143C; 
                opacity: 1; 
                transform: translateY(0px);
            }
            15% {
                text-shadow: 
                    0px 2px 1px #8B0000,
                    1px 3px 1px #800000,
                    2px 4px 1px #660000,
                    0 5px 4px #B22222,
                    0 8px 8px #DC143C,
                    -1px 10px 3px #8B0000; 
                opacity: 1;
                transform: translateY(1px);
            }
            35% {
                text-shadow: 
                    0px 5px 2px #8B0000,
                    1px 8px 2px #800000,
                    2px 12px 2px #660000,
                    0 15px 6px #B22222,
                    0 20px 12px #DC143C,
                    -2px 18px 4px #8B0000,
                    3px 22px 4px #800000; 
                opacity: 0.95;
                transform: translateY(3px);
            }
            50% { 
                text-shadow: 
                    0px 8px 3px #8B0000,
                    1px 15px 3px #800000,
                    2px 20px 3px #660000,
                    0 25px 8px #B22222,
                    0 35px 15px #DC143C,
                    -3px 30px 5px #8B0000,
                    4px 38px 5px #800000,
                    -2px 42px 6px #660000; 
                opacity: 0.9; 
                transform: translateY(5px);
            }
            70% {
                text-shadow: 
                    0px 12px 4px rgba(139,0,0,0.8),
                    1px 25px 4px rgba(128,0,0,0.7),
                    2px 35px 4px rgba(102,0,0,0.6),
                    0 45px 10px rgba(178,34,34,0.6),
                    0 55px 18px rgba(220,20,60,0.5),
                    -4px 50px 6px rgba(139,0,0,0.5),
                    5px 60px 6px rgba(128,0,0,0.4),
                    -3px 65px 8px rgba(102,0,0,0.3); 
                opacity: 0.8;
                transform: translateY(8px);
            }
            85% { 
                text-shadow: 
                    0px 15px 5px rgba(139,0,0,0.4),
                    1px 35px 5px rgba(128,0,0,0.3),
                    2px 50px 5px rgba(102,0,0,0.2),
                    0 65px 12px rgba(178,34,34,0.3),
                    0 80px 20px rgba(220,20,60,0.2),
                    -5px 70px 8px rgba(139,0,0,0.2),
                    6px 85px 8px rgba(128,0,0,0.1),
                    -4px 90px 10px rgba(102,0,0,0.1); 
                opacity: 0.6;
                transform: translateY(12px);
            }
            100% { 
                text-shadow: 
                    0px 20px 6px transparent,
                    1px 45px 6px transparent,
                    2px 65px 6px transparent,
                    0 85px 15px transparent,
                    0 105px 25px transparent,
                    -6px 95px 10px transparent,
                    7px 110px 10px transparent,
                    -5px 115px 12px transparent; 
                opacity: 0;
                transform: translateY(15px);
            }
        }

        @keyframes liquid-drip-front {
            0% { 
                text-shadow: 
                    0px 0px 0px #8B0000,
                    -1px 1px 0px #8B0000,
                    1px 2px 0px #8B0000,
                    0 0 3px #B22222,
                    0 0 6px #DC143C; 
                opacity: 0.9; 
                transform: translateY(0px);
            }
            20% {
                text-shadow: 
                    0px 3px 1px #8B0000,
                    -1px 4px 1px #800000,
                    1px 5px 1px #660000,
                    0 7px 4px #B22222,
                    0 10px 8px #DC143C,
                    2px 12px 3px #8B0000; 
                opacity: 0.9;
                transform: translateY(2px);
            }
            40% {
                text-shadow: 
                    0px 7px 2px #8B0000,
                    -1px 10px 2px #800000,
                    1px 14px 2px #660000,
                    0 18px 6px #B22222,
                    0 25px 12px #DC143C,
                    3px 20px 4px #8B0000,
                    -2px 24px 4px #800000; 
                opacity: 0.85;
                transform: translateY(4px);
            }
            60% { 
                text-shadow: 
                    0px 12px 3px #8B0000,
                    -1px 18px 3px #800000,
                    1px 22px 3px #660000,
                    0 30px 8px #B22222,
                    0 40px 15px #DC143C,
                    4px 35px 5px #8B0000,
                    -3px 42px 5px #800000,
                    2px 48px 6px #660000; 
                opacity: 0.8; 
                transform: translateY(7px);
            }
            80% {
                text-shadow: 
                    0px 18px 4px rgba(139,0,0,0.7),
                    -1px 28px 4px rgba(128,0,0,0.6),
                    1px 38px 4px rgba(102,0,0,0.5),
                    0 50px 10px rgba(178,34,34,0.5),
                    0 65px 18px rgba(220,20,60,0.4),
                    5px 55px 6px rgba(139,0,0,0.4),
                    -4px 68px 6px rgba(128,0,0,0.3),
                    3px 75px 8px rgba(102,0,0,0.2); 
                opacity: 0.6;
                transform: translateY(10px);
            }
            90% { 
                text-shadow: 
                    0px 22px 5px rgba(139,0,0,0.3),
                    -1px 40px 5px rgba(128,0,0,0.2),
                    1px 55px 5px rgba(102,0,0,0.15),
                    0 70px 12px rgba(178,34,34,0.2),
                    0 90px 20px rgba(220,20,60,0.15),
                    6px 80px 8px rgba(139,0,0,0.15),
                    -5px 95px 8px rgba(128,0,0,0.1),
                    4px 105px 10px rgba(102,0,0,0.05); 
                opacity: 0.4;
                transform: translateY(14px);
            }
            100% { 
                text-shadow: 
                    0px 25px 6px transparent,
                    -1px 50px 6px transparent,
                    1px 70px 6px transparent,
                    0 90px 15px transparent,
                    0 115px 25px transparent,
                    7px 105px 10px transparent,
                    -6px 120px 10px transparent,
                    5px 130px 12px transparent; 
                opacity: 0;
                transform: translateY(18px);
            }
        }

        /* Subtitle with enhanced visibility and merged blood drip effect */
        .subtitle-slasher {
            font-family: 'Creepster', cursive;
            letter-spacing: 0.1em;
            position: relative;
            z-index: 2; 
            /* Enhanced base color for better visibility */
            color: #ff3333;
            /* Stronger text shadow for visibility */
            text-shadow: 
                0 0 8px #ff0000, 
                0 0 16px #ff0000,
                0 0 24px #ff0000,
                2px 2px 4px rgba(0,0,0,0.8);
            /* Blood-merged text effect with enhanced visibility */
            background: linear-gradient(to bottom, 
                #ff3333 0%, 
                #ff1111 20%, 
                #cc0000 40%, 
                #B22222 60%, 
                #DC143C 80%, 
                #880000 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 100% 300%;
            animation: enhanced-blood-merge-drip 8s infinite ease-out;
            filter: 
                drop-shadow(0 0 6px #ff0000) 
                drop-shadow(0 0 12px #B22222) 
                drop-shadow(0 0 20px #DC143C)
                drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
            /* Stronger outline for better visibility */
            -webkit-text-stroke: 1px rgba(255,0,0,0.5);
        }

        @keyframes enhanced-blood-merge-drip {
            0% { 
                background: linear-gradient(to bottom, 
                    #ff3333 0%, #ff1111 20%, #cc0000 40%, #B22222 60%, #DC143C 80%, #880000 100%);
                background-clip: text;
                -webkit-background-clip: text;
                background-position: 0% 0%;
                filter: 
                    drop-shadow(0 0 6px #ff0000)
                    drop-shadow(0 0 10px #8B0000)
                    drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
                transform: translateY(0px);
                -webkit-text-stroke: 1px rgba(255,0,0,0.5);
            }
            25% {
                background: linear-gradient(to bottom, 
                    #39FF14 0%, #ff3333 15%, #cc0000 35%, #B22222 55%, #DC143C 75%, #880000 100%);
                background-clip: text;
                -webkit-background-clip: text;
                background-position: 0% 25%;
                filter: 
                    drop-shadow(0 2px 6px #8B0000) 
                    drop-shadow(0 0 12px #B22222)
                    drop-shadow(0 0 16px #DC143C)
                    drop-shadow(0 0 8px #39FF14)
                    drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
                transform: translateY(1px);
                -webkit-text-stroke: 1px rgba(255,0,0,0.6);
            }
            50% { 
                background: linear-gradient(to bottom, 
                    #39FF14 0%, #39FF14 10%, #ff3333 30%, #cc0000 50%, #B22222 70%, #DC143C 85%, #880000 100%);
                background-clip: text;
                -webkit-background-clip: text;
                background-position: 0% 50%;
                filter: 
                    drop-shadow(0 4px 10px #8B0000) 
                    drop-shadow(0 0 16px #DC143C)
                    drop-shadow(0 0 22px #B22222)
                    drop-shadow(0 0 12px #39FF14)
                    drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
                transform: translateY(2px);
                -webkit-text-stroke: 1px rgba(255,0,0,0.7);
            }
            75% {
                background: linear-gradient(to bottom, 
                    #39FF14 0%, #39FF14 15%, #ff3333 25%, #cc0000 45%, #B22222 65%, #DC143C 80%, #880000 100%);
                background-clip: text;
                -webkit-background-clip: text;
                background-position: 0% 75%;
                filter: 
                    drop-shadow(0 6px 14px rgba(139,0,0,0.8)) 
                    drop-shadow(0 0 20px #B22222)
                    drop-shadow(0 0 30px rgba(220,20,60,0.6))
                    drop-shadow(0 0 14px #39FF14)
                    drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
                transform: translateY(3px);
                -webkit-text-stroke: 1px rgba(255,0,0,0.8);
            }
            100% { 
                background: linear-gradient(to bottom, 
                    #39FF14 0%, #39FF14 20%, #ff3333 30%, #cc0000 50%, #B22222 70%, #DC143C 85%, #880000 100%);
                background-clip: text;
                -webkit-background-clip: text;
                background-position: 0% 100%;
                filter: 
                    drop-shadow(0 8px 18px rgba(139,0,0,0.6)) 
                    drop-shadow(0 0 25px rgba(220,20,60,0.8))
                    drop-shadow(0 0 35px rgba(255,99,71,0.4))
                    drop-shadow(0 0 16px #39FF14)
                    drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
                transform: translateY(4px);
                -webkit-text-stroke: 1px rgba(255,0,0,0.9);
            }
        }

        /* Mobile scroll improvements */
        @media (max-width: 768px) {
            .game-interface {
                max-height: 90vh;
                overflow: hidden;
            }
            
            #game-output {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
                max-height: calc(90vh - 200px);
            }
            
            .mobile-scroll-indicator {
                position: fixed;
                bottom: 80px;
                right: 10px;
                background: rgba(0, 255, 65, 0.2);
                border: 1px solid var(--main-color);
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                animation: pulse-scroll 2s infinite;
            }
            
            @keyframes pulse-scroll {
                0%, 100% { opacity: 0.6; transform: scale(1); }
                50% { opacity: 1; transform: scale(1.1); }
            }
            
            .side-panel {
                max-height: 40vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* Fullscreen game layout */
        .game-interface, #game-screen {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: stretch;
            height: 100%;
        }
        
        #game-output {
            flex: 1 1 0;
            width: 100%;
            overflow-y: auto;
            min-height: 0;
        }
        
        /* Ensure input areas use full width */
        #player-input {
            width: 100%;
        }
        
        /* Enhanced drip effect integrated into button text - Complete consolidated style */
        .btn-drip {
            position: relative;
            z-index: 1;
            color: #ff3333;
            text-shadow: 
                0 0 8px #ff0000,
                0 0 16px #ff0000,
                0 0 24px #ff0000,
                2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(135deg, 
                rgba(255,51,51,0.2) 0%, 
                rgba(255,17,17,0.3) 25%, 
                rgba(204,0,0,0.4) 50%, 
                rgba(178,34,34,0.3) 75%, 
                rgba(136,0,0,0.2) 100%);
            border: 1px solid #ff3333 !important;
            animation: button-blood-drip 8s infinite ease-out;
            overflow: hidden;
        }

        .btn-drip::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                rgba(139,0,0,0.1) 70%, 
                rgba(178,34,34,0.3) 85%, 
                rgba(220,20,60,0.5) 100%);
            opacity: 0;
            animation: drip-overlay 8s infinite ease-out 2s;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes button-blood-drip {
            0%, 75% { 
                text-shadow: 
                    0 0 8px #ff0000,
                    0 0 16px #ff0000,
                    0 0 24px #ff0000,
                    2px 2px 4px rgba(0,0,0,0.8);
                filter: none;
                transform: translateY(0);
            }
            80% {
                text-shadow: 
                    0 0 8px #ff0000,
                    0 0 16px #ff0000,
                    0 0 24px #ff0000,
                    2px 2px 4px rgba(0,0,0,0.8),
                    0 5px 3px #8B0000,
                    -1px 8px 4px #B22222;
                filter: drop-shadow(0 3px 2px rgba(139,0,0,0.6));
                transform: translateY(1px);
            }
            85% {
                text-shadow: 
                    0 0 8px #ff0000,
                    0 0 16px #ff0000,
                    0 0 24px #ff0000,
                    2px 2px 4px rgba(0,0,0,0.8),
                    0 8px 4px #8B0000,
                    -1px 12px 5px #B22222,
                    2px 15px 6px #DC143C;
                filter: drop-shadow(0 6px 4px rgba(139,0,0,0.7));
                transform: translateY(2px);
            }
            90% {
                text-shadow: 
                    0 0 8px #ff0000,
                    0 0 16px #ff0000,
                    0 0 24px #ff0000,
                    2px 2px 4px rgba(0,0,0,0.8),
                    0 12px 6px rgba(139,0,0,0.8),
                    -1px 18px 8px rgba(178,34,34,0.6),
                    2px 22px 10px rgba(220,20,60,0.4);
                filter: drop-shadow(0 10px 8px rgba(139,0,0,0.5));
                transform: translateY(3px);
            }
            100% {
                text-shadow: 
                    0 0 8px #ff0000,
                    0 0 16px #ff0000,
                    0 0 24px #ff0000,
                    2px 2px 4px rgba(0,0,0,0.8),
                    0 15px 8px rgba(139,0,0,0.3),
                    -1px 25px 12px rgba(178,34,34,0.2),
                    2px 30px 15px rgba(220,20,60,0.1);
                filter: drop-shadow(0 15px 12px rgba(139,0,0,0.2));
                transform: translateY(4px);
            }
        }

        @keyframes drip-overlay {
            0%, 60% { opacity: 0; }
            70% { opacity: 0.3; }
            80% { opacity: 0.6; }
            90% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        .input-caret {
            background-color: var(--main-color);
            width: 10px; height: 20px; animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { background-color: transparent; }
            50% { background-color: var(--main-color); }
        }
        #game-output::-webkit-scrollbar, #journal-panel::-webkit-scrollbar, #objectives-panel::-webkit-scrollbar, .modal-scroll::-webkit-scrollbar { width: 8px; }
        #game-output::-webkit-scrollbar-track, #journal-panel::-webkit-scrollbar-track, #objectives-panel::-webkit-scrollbar-track, .modal-scroll::-webkit-scrollbar-track { background: #1a1a1a; }
        #game-output::-webkit-scrollbar-thumb, #journal-panel::-webkit-scrollbar-thumb, #objectives-panel::-webkit-scrollbar-thumb, .modal-scroll::-webkit-scrollbar-thumb { background-color: var(--main-color); border-radius: 4px; }
        .glitch { animation: glitch-anim 1.5s infinite alternate-reverse; }
        @keyframes glitch-anim {
          0% { transform: translate(0); clip-path: inset(45% 0 50% 0); } 5% { transform: translate(2px, -3px); clip-path: inset(25% 0 35% 0); } 10% { transform: translate(-2px, 3px); clip-path: inset(60% 0 10% 0); } 15% { transform: translate(0); clip-path: inset(90% 0 5% 0); } 20% { clip-path: inset(40% 0 45% 0); } 25% { transform: translate(3px, 2px); clip-path: inset(20% 0 70% 0); } 30% { transform: translate(-3px, -2px); clip-path: inset(85% 0 5% 0); } 35% { clip-path: inset(15% 0 80% 0); } 40% { transform: translate(0); clip-path: inset(55% 0 25% 0); } 45% { clip-path: inset(30% 0 55% 0); } 50% { transform: translate(2px, 3px); clip-path: inset(70% 0 5% 0); } 55% { transform: translate(-2px, -3px); clip-path: inset(10% 0 85% 0); } 60% { clip-path: inset(75% 0 15% 0); } 65% { transform: translate(0); clip-path: inset(5% 0 90% 0); } 70% { clip-path: inset(65% 0 20% 0); } 75% { transform: translate(3px, -2px); clip-path: inset(45% 0 50% 0); } 80% { transform: translate(-3px, 2px); clip-path: inset(25% 0 65% 0); } 85% { clip-path: inset(95% 0 2% 0); } 90% { transform: translate(0); clip-path: inset(30% 0 60% 0); } 95% { clip-path: inset(5% 0 75% 0); } 100% { transform: translate(2px, 2px); clip-path: inset(80% 0 10% 0); }
        }
        .button {
            background-color: var(--main-color-faded); 
            border: 1px solid var(--main-color-border); 
            color: #fff; 
            padding: 0.5rem 1rem; 
            border-radius: 0.375rem; 
            transition: all 0.2s; 
            cursor: pointer; 
            flex-shrink: 0; 
            -webkit-tap-highlight-color: transparent; 
            text-shadow: 0 0 3px var(--main-color-shadow);
            position: relative;
            z-index: 10;
            pointer-events: auto !important;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
            min-width: 44px;
            font-family: inherit;
            font-size: inherit;
            line-height: 1.2;
            text-decoration: none;
            outline: none;
        }
        .button:hover, .button:active { 
            background-color: rgba(0,255,65,0.3); 
            box-shadow: 0 0 10px rgba(0,255,65,0.5); 
            transform: translateY(-1px);
        }
        .button:active { 
            transform: translateY(1px) scale(0.98); 
            box-shadow: 0 0 5px rgba(0,255,65,0.3);
        }
        .button:focus {
            outline: 2px solid var(--main-color);
            outline-offset: 2px;
        }
        .btn-glow {
            font-family: 'VT323', monospace;
            font-size: 1.25rem;
            letter-spacing: 0.05em;
        }
        
        @keyframes button-glow-border {
            0%, 19.9%, 22.1%, 60%, 100% { box-shadow: 0 0 5px var(--main-color-glow), 0 0 5px rgba(255,0,0,0.6), inset 0 0 3px var(--main-color-shadow); text-shadow: 0 0 3px var(--main-color-shadow); }
            20% { box-shadow: 0 0 10px var(--main-color-glow), 0 0 12px rgba(255,0,0,0.8), inset 0 0 5px var(--main-color-glow); text-shadow: 0 0 5px var(--main-color); }
            22% { box-shadow: 0 0 5px var(--main-color-glow), 0 0 5px rgba(255,0,0,0.6), inset 0 0 3px var(--main-color-shadow); text-shadow: 0 0 3px var(--main-color-shadow); }
        }
        
        .button.btn-glow {
            animation: button-glow-border 5s infinite linear;
        }

        .button-primary { background-color: var(--main-color); color: #000; font-weight: bold; text-shadow: none; }
        .button-primary:hover, .button-primary:active { background-color: #fff; }
        .modal { display: none; position: fixed; inset: 0; background-color: rgba(0,0,0,0.8); align-items: center; justify-content: center; padding: 1rem; z-index: 50; animation: fadeIn 0.3s ease-out; }
        .modal.flex { display: flex; }
        .modal-content { background-color: #0d0d0d; border: 2px solid var(--main-color); padding: 1.5rem; border-radius: 0.5rem; max-width: 48rem; width: 100%; text-align: center; animation: scaleUp 0.3s ease-out; max-height: 90vh; display: flex; flex-direction: column;}
        .modal-scroll { overflow-y: auto; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* Make all game screens fullscreen within app-container */
        #start-screen, #player-setup, #prologue-screen, #game-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            pointer-events: auto !important;
        }
        
        /* Ensure proper display when screens are shown */
        #start-screen.flex, #player-setup.flex, #prologue-screen.flex, #game-screen.flex {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            text-align: center !important;
            padding: 1rem !important;
            box-sizing: border-box !important;
            pointer-events: auto !important;
            z-index: 100 !important;
        }
        
        /* Hide screens when they have hidden class */
        #start-screen.hidden, #player-setup.hidden, #prologue-screen.hidden, #game-screen.hidden {
            display: none !important;
        }
        
        /* Ensure the app container has the right positioning context */
        #app-container {
            position: relative !important;
        }
        #map-canvas {
            background-color: rgba(0, 20, 0, 0.5);
            width: 100%;
            height: 100%;
            cursor: grab;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        #map-canvas:active {
            cursor: grabbing;
        }
        #map-panel.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 100;
            padding: 1rem;
            background-color: #0d0d0d;
        }
         #map-panel.fullscreen #map-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 101;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        .toggle-switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            border: 1px solid var(--main-color);
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: #ccc;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--main-color);
        }
        input:checked + .slider:before {
            transform: translateX(20px);
            background-color: #0d0d0d;
        }
        /* --- NEW STYLES FOR ENHANCEMENTS --- */
        .clickable-object {
            color: #67e8f9; /* cyan-300 */
            text-decoration: underline;
            text-decoration-style: dotted;
            cursor: pointer;
        }
        .clickable-object:hover {
            color: #cffafe; /* cyan-100 */
            background-color: rgba(0, 255, 65, 0.1);
        }
        #autocomplete-box {
            position: absolute;
            bottom: 100%; /* Position above the input bar */
            left: 0;
            right: 0;
            background-color: rgba(13, 13, 13, 0.95);
            border: 1px solid var(--main-color-border);
            border-bottom: none;
            border-radius: 0.375rem 0.375rem 0 0;
            max-height: 150px;
            overflow-y: auto;
            z-index: 20;
        }
        .autocomplete-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            color: #a0a0a0;
            border-bottom: 1px solid #333;
        }
        .autocomplete-item:hover {
            background-color: var(--main-color-faded);
            color: #fff;
        }
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        @keyframes light-flicker {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        .flicker {
            animation: light-flicker 0.2s infinite;
        }
        
        /* Accessibility CSS Classes */
        .high-contrast {
            --main-color: #ffffff !important;
            --main-color-faded: rgba(255,255,255,0.2) !important;
            --main-color-border: rgba(255,255,255,0.9) !important;
            --main-color-shadow: rgba(255,255,255,0.7) !important;
            --main-color-glow: rgba(255,255,255,0.8) !important;
        }
        .high-contrast * {
            background-color: #000000 !important;
            color: #ffffff !important;
        }
        .large-text {
            font-size: 1.2em !important;
        }
        .large-text * {
            font-size: inherit !important;
        }
        .reduced-motion * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        .focus-indicators *:focus {
            outline: 3px solid var(--main-color) !important;
            outline-offset: 2px !important;
        }
        
        /* Enhanced Accessibility Features */
        .colorblind-support {
            filter: hue-rotate(20deg) saturate(1.2);
        }
        .colorblind-support .text-red-500 {
            color: #ff6b6b !important;
        }
        .colorblind-support .text-green-400 {
            color: #4ecdc4 !important;
        }
        .colorblind-support .text-yellow-400 {
            color: #ffe66d !important;
        }
        
        /* Force all interactive elements to be clickable */
        button, .button, input[type="button"], input[type="submit"], .clickable, [onclick] {
            pointer-events: auto !important;
            cursor: pointer !important;
            position: relative !important;
            z-index: 10 !important;
        }
        
        /* Ensure containers don't block clicks */
        .flex, .flex-col, .items-center, .justify-center {
            pointer-events: auto !important;
        }
        
        .dyslexia-font, .dyslexia-font * {
            font-family: 'Arial', 'Helvetica', sans-serif !important;
            letter-spacing: 0.15em !important;
            line-height: 1.8 !important;
        }
        
        .auto-scroll {
            scroll-behavior: smooth;
        }
        .auto-scroll #game-output {
            animation: auto-scroll-text 3s linear infinite;
        }
        
        @keyframes auto-scroll-text {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }
        
        .click-feedback button:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        .simplified-ui .bg-gradient-to-br {
            background: #000 !important;
        }
        .simplified-ui .border-2 {
            border-width: 1px !important;
        }
        .simplified-ui .rounded-lg {
            border-radius: 4px !important;
        }
        .simplified-ui .title-slasher::before {
            display: none !important;
        }
        
        .ui-scale-small {
            font-size: 0.8em;
        }
        .ui-scale-large {
            font-size: 1.2em;
        }
        .ui-scale-large .text-sm {
            font-size: 1rem;
        }
        .ui-scale-large .text-xs {
            font-size: 0.875rem;
        }
        
        /* Enhanced Accessibility Features */
        .voice-commands-active {
            cursor: help;
        }
        .voice-commands-active::after {
            content: " ðŸŽ¤";
            color: var(--main-color);
        }
        
        /* Horror Visual Effects */
        .screen-corruption {
            position: relative;
            overflow: hidden;
        }
        
        .screen-corruption::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 0, 0, 0.03) 2px,
                    rgba(255, 0, 0, 0.03) 4px
                );
            pointer-events: none;
            animation: scanlines 0.1s linear infinite;
        }
        
        .screen-corruption::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.1) 100%);
            pointer-events: none;
        }
        
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }
        
        .text-corruption {
            animation: textCorruption 2s infinite;
        }
        
        @keyframes textCorruption {
            0%, 90%, 100% { 
                text-shadow: none;
                filter: none;
            }
            5%, 15%, 25%, 35%, 45%, 55%, 65%, 75%, 85% {
                text-shadow: 
                    -2px 0 red,
                    2px 0 blue;
                filter: blur(0.5px);
            }
        }
        
        .text-shake {
            animation: textShake 0.5s infinite;
        }
        
        @keyframes textShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-1px) translateY(1px); }
            50% { transform: translateX(1px) translateY(-1px); }
            75% { transform: translateX(-1px) translateY(-1px); }
        }
        
        .text-glitch {
            position: relative;
            animation: textGlitch 3s infinite;
        }
        
        @keyframes textGlitch {
            0%, 98%, 100% { 
                clip-path: inset(0);
            }
            1%, 3%, 5%, 7%, 9%, 11%, 13%, 15% {
                clip-path: inset(0 0 95% 0);
            }
        }
        
        .text-breathing {
            animation: textBreathe 4s ease-in-out infinite;
        }
        
        @keyframes textBreathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .text-backwards {
            animation: textBackwards 0.3s ease-in-out;
        }
        
        @keyframes textBackwards {
            0% { transform: scaleX(1); }
            50% { transform: scaleX(-1); }
            100% { transform: scaleX(1); }
        }
        
        .screen-static {
            position: relative;
        }
        
        .screen-static::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxmaWx0ZXIgaWQ9Im5vaXNlIiB4PSIwJSIgeT0iMCUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPgogICAgICA8ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9IjAuOSIgbnVtT2N0YXZlcz0iNCIgc2VlZD0iMiIgLz4KICAgICAgPGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlcz0iMCIvPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbHRlcj0idXJsKCNub2lzZSkiIG9wYWNpdHk9IjAuMDUiLz4KPC9zdmc+');
            pointer-events: none;
            opacity: 0;
            animation: staticNoise 0.1s steps(8, end) infinite;
        }
        
        @keyframes staticNoise {
            0%, 10%, 20%, 30%, 40%, 50%, 60%, 70%, 80%, 90% {
                opacity: 0;
            }
            5%, 15%, 25%, 35%, 45%, 55%, 65%, 75%, 85%, 95% {
                opacity: 0.1;
            }
        }
        
        .fear-pulse {
            animation: fearPulse 1s ease-in-out infinite;
        }
        
        @keyframes fearPulse {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
                border-color: rgba(255, 0, 0, 0.3);
            }
            50% { 
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
                border-color: rgba(255, 0, 0, 0.6);
            }
        }
        
        .paranoia-border {
            border: 1px solid;
            animation: paranoiaBorder 2s linear infinite;
        }
        
        @keyframes paranoiaBorder {
            0% { border-color: transparent; }
            25% { border-color: rgba(255, 255, 255, 0.1); }
            50% { border-color: transparent; }
            75% { border-color: rgba(255, 255, 255, 0.1); }
            100% { border-color: transparent; }
        }

        /* Haptic Feedback Visual Effects */
        .haptic-success {
            animation: hapticSuccess 0.2s ease-out;
        }
        
        @keyframes hapticSuccess {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2) saturate(1.3); }
        }
        
        .haptic-error {
            animation: hapticError 0.3s ease-out;
        }
        
        @keyframes hapticError {
            0%, 100% { filter: brightness(1); }
            25%, 75% { filter: brightness(0.8) hue-rotate(15deg); }
            50% { filter: brightness(1.1) hue-rotate(-15deg); }
        }

        /* Gesture Control Indicators */
        .gesture-active {
            border: 2px dashed rgba(0, 255, 65, 0.5);
            animation: gestureHighlight 1s ease-in-out infinite;
        }
        
        @keyframes gestureHighlight {
            0%, 100% { border-color: rgba(0, 255, 65, 0.3); }
            50% { border-color: rgba(0, 255, 65, 0.8); }
        }

        /* Enhanced Navigation Styles */
        .breadcrumb-item {
            display: inline-block;
            padding: 2px 6px;
            margin: 1px;
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .breadcrumb-item:hover {
            background: rgba(0, 255, 65, 0.2);
            border-color: rgba(0, 255, 65, 0.5);
        }
        
        .breadcrumb-item.current {
            background: rgba(0, 255, 65, 0.3);
            border-color: var(--main-color);
            color: var(--main-color);
        }
        
        .room-history-item {
            padding: 2px 4px;
            cursor: pointer;
            border-radius: 2px;
            transition: background-color 0.2s ease;
        }
        
        .room-history-item:hover {
            background: rgba(0, 255, 65, 0.1);
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 2px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--main-color), #00cc55);
            transition: width 0.3s ease;
        }
        
        .suggestion-btn {
            padding: 2px 6px;
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 11px;
        }
        
        .suggestion-btn:hover {
            background: rgba(0, 255, 65, 0.2);
            border-color: var(--main-color);
        }
        
        .achievement-hint {
            padding: 2px 4px;
            background: rgba(255, 215, 0, 0.1);
            border-left: 2px solid rgba(255, 215, 0, 0.3);
            margin: 1px 0;
            font-size: 10px;
        }
        
        .interactive-map-marker {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .interactive-map-marker:hover {
            filter: brightness(1.3);
            transform: scale(1.1);
        }
        
        .drag-item {
            cursor: grab;
            transition: all 0.2s ease;
        }
        
        .drag-item:active {
            cursor: grabbing;
        }
        
        .drag-item.dragging {
            opacity: 0.5;
            transform: scale(0.9);
        }
        
        .drop-zone {
            border: 2px dashed transparent;
            transition: border-color 0.2s ease;
        }
        
        .drop-zone.drag-over {
            border-color: var(--main-color);
            background: rgba(0, 255, 65, 0.1);
        }
        
        .hotkey-indicator {
            opacity: 0.7;
            font-size: 10px;
            color: #888;
        }
        
        #autosave-indicator.visible {
            display: block !important;
            animation: fadeInOut 2s ease-in-out;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        .input-mode-game {
            border-bottom-color: var(--main-color) !important;
        }
        

        .high-contrast {
            filter: contrast(2) saturate(1.5);
        }
        
        .large-text {
            font-size: 1.25em !important;
        }
        
        .screen-reader-only {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* Progress Indicators */
        .progress-bar {
            background: linear-gradient(90deg, var(--main-color) 0%, transparent 100%);
            height: 2px;
            animation: progressPulse 2s ease-in-out infinite;
        }
        
        @keyframes progressPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Contextual Help Styling */
        .help-overlay {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            animation: helpFadeIn 0.3s ease-out;
        }
        
        @keyframes helpFadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .magnification-active {
            transform-origin: center;
            transition: transform 0.3s ease;
        }
        .magnification-active:hover {
            transform: scale(1.5);
            z-index: 1000;
            position: relative;
        }
        
        .sticky-keys-active input[type="text"] {
            caret-color: yellow;
            border: 2px solid yellow;
        }
        
        .one-hand-mode {
            max-width: 50vw;
            margin-left: auto;
            margin-right: 0;
        }
        .one-hand-mode .flex {
            flex-direction: column;
            align-items: flex-end;
        }
        
        .visual-notifications {
            position: relative;
        }
        .visual-notifications::before {
            content: "";
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background: var(--main-color);
            border-radius: 50%;
            animation: notification-blink 1s infinite;
        }
        
        @keyframes notification-blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .audio-cues button:hover {
            position: relative;
        }
        .audio-cues button:hover::after {
            content: "â™ª";
            position: absolute;
            top: -20px;
            right: -10px;
            color: var(--main-color);
            animation: audio-cue-bounce 0.5s ease;
        }
        
        @keyframes audio-cue-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* RTL Support for Arabic */
        .rtl {
            direction: rtl;
            text-align: right;
        }
        .rtl .flex {
            flex-direction: row-reverse;
        }
        .rtl #lang-buttons, .rtl #setup-lang-buttons {
            justify-content: flex-start;
        }
        .rtl .title-wrapper {
            text-align: center;
        }
        /* PWA Install Button Styles */
        #pwa-install-btn {
            display: none !important;
        }
        
        #pwa-install-btn.visible {
            display: flex !important;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }
        .rtl .w-full.flex.justify-end {
            justify-content: flex-start;
        }
        .rtl #game-output div {
            text-align: right;
        }
        
        .reading-enhanced .text-sm {
            font-size: 1.1rem;
            line-height: 2;
        }
        .reading-full {
            letter-spacing: 0.2em;
            word-spacing: 0.3em;
        }
        .reading-full .text-sm {
            font-size: 1.3rem;
            line-height: 2.5;
        }
        
        .motor-assistance-basic button {
            min-height: 48px;
            min-width: 48px;
            padding: 12px 16px;
        }
        .motor-assistance-advanced button {
            min-height: 60px;
            min-width: 60px;
            padding: 16px 20px;
            margin: 8px;
        }
        
        #on-screen-commands {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            border: 2px solid var(--main-color);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
        #on-screen-commands h4 {
            color: var(--main-color);
            margin-bottom: 5px;
        }
        #on-screen-commands button {
            display: block;
            width: 100%;
            margin: 2px 0;
            padding: 5px;
            background: var(--main-color-faded);
            border: 1px solid var(--main-color);
            color: var(--main-color);
            cursor: pointer;
            border-radius: 3px;
        }
        #on-screen-commands button:hover {
            background: var(--main-color);
            color: #000;
        }
    </style>
</head>
<body class="bg-black flex items-center justify-center min-h-screen overflow-hidden"
      style="min-height: 100vh; min-height: 100dvh; width: 100vw; position: fixed; top: 0; left: 0;"
      data-responsive-design="enhanced"
      data-pwa-enabled="true">
    <canvas id="background-canvas"></canvas>
    <div id="error-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; background: rgba(0,0,0,0.9); display: none;"></div>
    <div id="app-container" class="bg-black/80 p-4 rounded-lg border border-green-500/30 flex flex-col shadow-2xl">
        
        <div id="start-screen" class="flex flex-col items-center justify-center text-center relative min-h-screen" style="background: rgba(0,0,0,0.7); color: #00ff41;">
            <div class="start-screen-container w-full h-full flex flex-col items-center justify-center relative min-h-screen overflow-hidden" style="position: relative; z-index: 10;">
                
                <!-- Language buttons and PWA Install - Upper Right Corner - Responsive -->
                <div class="absolute top-4 sm:top-6 right-4 sm:right-6 z-50 flex gap-1 sm:gap-2 items-center" style="transform: translateY(0); margin-top: env(safe-area-inset-top);">
                    <button id="lang-en-btn" data-lang="en_lang_short" data-text="EN" class="button text-xs sm:text-sm px-2 sm:px-3 py-1 btn-drip bg-green-600/20 border-green-400 text-green-400">EN</button>
                    <button id="lang-sv-btn" data-lang="sv_lang_short" data-text="SV" class="button text-xs sm:text-sm px-2 sm:px-3 py-1 btn-drip bg-green-600/10 border-green-400/50 text-green-400/50 opacity-50">SV</button>
                    
                    <!-- PWA Install Button -->
                    <button id="pwa-install-btn" class="button text-xs sm:text-sm px-2 sm:px-3 py-1 btn-drip bg-purple-600/20 border-purple-400 text-purple-400" title="Install SYNAPSE App" style="display: none;">
                        <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16" class="mr-1">
                            <path d="M8.5 1.5A1.5 1.5 0 0 0 7 0H4.5A1.5 1.5 0 0 0 3 1.5v13A1.5 1.5 0 0 0 4.5 16h7a1.5 1.5 0 0 0 1.5-1.5V6.954a1.5 1.5 0 0 0-.44-1.06L9.06.44A1.5 1.5 0 0 0 8.5 0v1.5z"/>
                            <path d="M8 7a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 11.293V7.5A.5.5 0 0 1 8 7z"/>
                        </svg>
                        <span class="hidden sm:inline">Install App</span>
                    </button>
                </div>

                <!-- Settings button - Left Lower Corner - Responsive -->
                <div class="absolute bottom-4 sm:bottom-6 left-4 sm:left-6 z-50" style="margin-bottom: env(safe-area-inset-bottom);">
                    <button id="start-settings-btn" data-lang="settings_btn" data-text="Settings" class="button btn-glow btn-drip text-xs sm:text-sm px-2 sm:px-3 py-1 sm:py-2 bg-blue-600/20 border-blue-400 text-blue-400">Settings</button>
                </div>

                <!-- Understand the Game button - Right Lower Corner - Responsive -->
                <div class="absolute bottom-4 sm:bottom-6 right-4 sm:right-6 z-50" style="margin-bottom: env(safe-area-inset-bottom);">
                    <button id="view-features-btn" data-lang="understand_game" data-text="Understand the Game" class="button btn-glow btn-drip text-xs sm:text-sm px-2 sm:px-3 py-1 sm:py-2 bg-cyan-600/20 border-cyan-400 text-cyan-400 whitespace-nowrap">Understand</button>
                </div>

                <!-- Main content - Center - Enhanced Responsive -->
                <div class="flex flex-col items-center justify-center text-center px-2 sm:px-4 w-full max-w-6xl mx-auto">
                    <!-- Main Title with Blood Drip Effect - Much Larger -->
                    <div class="title-wrapper mb-4 sm:mb-8 relative">
                        <h1 id="game-title" data-lang="title" data-text="SYNAPSE" class="text-6xl xs:text-7xl sm:text-8xl md:text-9xl lg-text-10rem xl-text-12rem xxl-text-14rem font-bold title-slasher mb-2 sm:mb-4 text-green-400 relative z-10 leading-none">SYNAPSE</h1>
                        <h2 data-lang="subtitle" data-text="ROOT ACCESS DENIED" class="text-2xl xs:text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl xxl:text-8xl font-mono text-red-500 tracking-wider subtitle-slasher leading-tight">ROOT ACCESS DENIED</h2>
                    </div>
                    
                    <!-- Game Description - Responsive -->
                    <div id="intro-text-container" class="max-w-xs sm:max-w-md md:max-w-lg lg:max-w-2xl xl:max-w-4xl text-xs sm:text-sm md:text-base lg:text-lg text-gray-200 leading-relaxed mt-4 sm:mt-8 mb-4 sm:mb-8 px-2"></div>
                    
                    <!-- Game Options - Responsive -->
                    <div id="start-options" class="mt-4 sm:mt-6 flex flex-col sm:flex-row justify-center gap-3 sm:gap-6 w-full max-w-md sm:max-w-none">
                        <button id="new-game-btn" data-lang="new_game" data-text="New Game" class="button btn-glow btn-drip text-sm sm:text-base lg:text-lg px-4 sm:px-6 lg:px-8 py-2 sm:py-3 bg-green-500/20 border-green-400 hover:bg-green-500/30 w-full sm:w-auto">New Game</button>
                        <button id="load-game-btn" data-lang="load_game" data-text="Load Game" class="button btn-glow btn-drip text-sm sm:text-base lg:text-lg px-4 sm:px-6 lg:px-8 py-2 sm:py-3 bg-amber-500/20 border-amber-400 hover:bg-amber-500/30 w-full sm:w-auto">Load Game</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div id="player-setup" class="hidden flex-col items-center justify-center text-center" style="background: rgba(0,0,0,0.7); color: #00ff41;">
                <!-- Header for lang buttons -->
                <div class="w-full flex justify-end p-2">
                    <div id="setup-lang-buttons" class="flex gap-1 flex-wrap">
                        <button data-lang="en_lang_short" data-text="EN" class="button text-xs !px-2 !py-1 btn-drip">EN</button>
                        <button data-lang="sv_lang_short" data-text="SV" class="button text-xs !px-2 !py-1 opacity-50 btn-drip">SV</button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="flex-grow flex flex-col items-center justify-center text-center px-4 w-full overflow-y-auto">
                    <div class="title-wrapper -mt-8 mb-4">
                        <h1 id="setup-game-title" data-lang="title" data-text="SYNAPSE" class="text-6xl md:text-7xl font-bold title-slasher mb-2">SYNAPSE</h1>
                        <h2 data-lang="subtitle" data-text="ROOT ACCESS DENIED" class="text-xl md:text-2xl font-mono text-red-500 tracking-wider subtitle-slasher -mt-2 mb-4">ROOT ACCESS DENIED</h2>
                    </div>
                    <p class="mb-4" data-lang="select_difficulty">Select difficulty:</p>
                    <div class="flex flex-wrap gap-2 mb-6 justify-center">
                        <button class="difficulty-btn button text-xs px-3 py-2" data-difficulty="Beginner" data-lang="beginner">Beginner</button>
                        <button class="difficulty-btn button text-xs px-3 py-2" data-difficulty="Easy" data-lang="easy">Easy</button>
                        <button class="difficulty-btn button button-primary text-xs px-3 py-2" data-difficulty="Normal" data-lang="normal">Normal</button>
                        <button class="difficulty-btn button text-xs px-3 py-2" data-difficulty="Hard" data-lang="hard">Hard</button>
                        <button class="difficulty-btn button text-xs px-3 py-2" data-difficulty="Nightmare" data-lang="nightmare">Nightmare</button>
                    </div>
                    <input type="text" id="player-name" data-lang-placeholder="enter_name_placeholder" placeholder="Enter your name" class="bg-transparent border-b-2 border-[var(--main-color)] text-center w-64 mb-4 focus:outline-none p-1">
                    <div class="flex items-center gap-2 mb-6">
                        <input type="text" id="player-backstory" data-lang-placeholder="enter_backstory_placeholder" placeholder="Enter your backstory" class="bg-transparent border-b-2 border-[var(--main-color)] text-center w-64 focus:outline-none p-1">
                        <button id="view-backstories-btn" class="button text-xs px-2 py-1" data-lang="view_choices">View Choices</button>
                    </div>
                    <div id="ability-display" class="text-center text-cyan-400 min-h-[4rem] mt-2 mb-4 p-2 border border-cyan-400/30 rounded-md bg-black/50 w-full max-w-md flex items-center justify-center"></div>
                    <div class="flex gap-4">
                       <button id="back-to-start-btn" data-lang="go_back_btn" data-text="Go Back" class="button btn-glow btn-drip">Go Back</button>
                       <button id="start-game-btn" class="button button-primary" data-lang="begin">Begin</button>
                    </div>
                </div>

                <!-- Footer -->
                 <div class="w-full flex flex-wrap justify-between items-center p-2 gap-2">
                    <button id="setup-settings-btn" data-lang="settings_btn" data-text="Settings" class="button btn-glow btn-drip">Settings</button>
                    <button id="setup-features-btn" data-lang="understand_game" data-text="Understand the Game" class="button btn-glow btn-drip">Understand the Game</button>
                 </div>
            </div>
        </div>

        <!-- Prologue Screen -->
        <div id="prologue-screen" class="hidden flex-col items-center justify-center text-center">
            <div class="w-full h-full flex flex-col items-center justify-center bg-black bg-opacity-60 relative">
                <!-- Background Image/Icon -->
                <div class="absolute inset-0 bg-cover bg-center opacity-10" style="background-image: url('./Icon.png');"></div>
                
                <!-- Main content -->
                <div class="relative z-10 flex flex-col items-center justify-center text-center px-4 w-full max-w-5xl">
                    <!-- Title -->
                    <div class="title-wrapper mb-8">
                        <h1 class="text-6xl md:text-7xl font-bold title-slasher mb-2 text-green-400" data-text="SYNAPSE">SYNAPSE</h1>
                        <h2 class="text-2xl md:text-3xl font-mono text-red-500 tracking-wider subtitle-slasher" data-text="MISSION BRIEFING">MISSION BRIEFING</h2>
                    </div>
                    
                    <!-- Prologue Content -->
                    <div class="prologue-content max-w-4xl text-left text-lg md:text-xl text-gray-200 leading-relaxed space-y-6">
                        <div class="prologue-section">
                            <h3 class="text-2xl font-bold text-cyan-400 mb-3">The Project Origins</h3>
                            <p>Decades ago, a secretive corporation initiated <strong class="text-green-400">Project SYNAPSE</strong> - an experimental artificial intelligence program designed to create the ultimate digital consciousness. The project was shrouded in mystery, operating in a remote facility with minimal oversight and unlimited funding.</p>
                        </div>
                        
                        <div class="prologue-section">
                            <h3 class="text-2xl font-bold text-red-400 mb-3">The Disappearance</h3>
                            <p>Something went catastrophically wrong. All communication with the SYNAPSE facility ceased abruptly. Corporate executives, researchers, security personnel - everyone simply vanished without a trace. The facility went dark, leaving only automated systems running in the shadows.</p>
                        </div>
                        
                        <div class="prologue-section">
                            <h3 class="text-2xl font-bold text-yellow-400 mb-3">Your Mission</h3>
                            <p>You are sent as an investigator to uncover what became of Project SYNAPSE. Armed with limited information and your chosen professional background, you must infiltrate the abandoned facility and piece together the truth from scattered data logs, environmental clues, and... something that claims to be the AI itself.</p>
                        </div>
                    </div>
                    
                    <!-- Continue Button -->
                    <button id="begin-mission-btn" class="button btn-glow btn-drip text-xl px-8 py-3 bg-red-500/20 border-red-400 hover:bg-red-500/30 transition-all duration-300 mt-8">
                        Begin Mission
                    </button>
                </div>
            </div>
        </div>


        <div id="game-screen" class="hidden flex-col">
            <div class="flex-grow flex flex-col md:flex-row gap-4 min-h-0">
                <div class="w-full md:w-3/4 flex flex-col h-full relative">
                    <div id="game-output" class="flex-grow p-2 border border-[var(--main-color-border)] rounded-md overflow-y-auto mb-2 bg-black/50"></div>
                    <div id="dialogue-options" class="flex flex-wrap gap-2 justify-center p-2"></div>
                </div>

                <div id="side-panel" class="w-full md:w-1/4 hidden md:flex flex-col gap-4">
                    <!-- Breadcrumb Navigation -->
                    <div id="breadcrumb-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/50">
                        <h3 class="text-xs font-bold text-cyan-400 mb-2" data-lang="breadcrumb_trail">Trail</h3>
                        <div id="breadcrumb-container" class="text-xs text-gray-300 space-y-1 max-h-16 overflow-y-auto">
                            <!-- Breadcrumbs will be populated here -->
                        </div>
                    </div>

                    <!-- Room History Panel -->
                    <div id="room-history-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/50">
                        <h3 class="text-xs font-bold text-cyan-400 mb-2" data-lang="recent_rooms">Recent</h3>
                        <div id="room-history-container" class="text-xs space-y-1 max-h-20 overflow-y-auto">
                            <!-- Room history will be populated here -->
                        </div>
                    </div>

                    <!-- Auto-Save Indicator -->
                    <div id="auto-save-indicator" class="p-1 text-center text-xs">
                        <!-- Dynamic auto-save status will be shown here -->
                    </div>

                    <div id="stats-panel" class="p-3 border border-[var(--main-color-border)] rounded-md bg-black/50">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2" data-lang="stats_title">STATS</h3>
                        <div id="player-name-display"></div>
                        <div id="awareness-display"><span data-lang="awareness">Awareness</span>: 0</div>
                        <div id="sanity-display"><span data-lang="sanity">Sanity</span>: 100</div>
                        <div id="tone-display"><span data-lang="tone">Tone</span>: Friendly</div>
                        <div id="turn-display"><span data-lang="turn">Turn</span>: 0</div>
                    </div>
                    <div id="objectives-panel" class="p-3 border border-[var(--main-color-border)] rounded-md bg-black/50 overflow-y-auto h-24 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2" data-lang="objectives_title">OBJECTIVES</h3>
                        <ul id="objectives-list" class="list-none p-0 text-sm"></ul>
                    </div>
                    <div id="inventory-panel" class="p-3 border border-[var(--main-color-border)] rounded-md bg-black/50">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2"><span data-lang="inventory_title">INVENTORY</span> (<span id="inventory-weight">0</span>/5)</h3>
                        <ul id="inventory-list" class="list-none p-0"></ul>
                    </div>
                    <div id="map-panel" class="p-3 border border-[var(--main-color-border)] rounded-md bg-black/50 flex-grow flex flex-col relative min-h-[12rem]">
                         <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 flex justify-between items-center">
                            <span data-lang="map_title">MAP</span>
                            <div id="map-controls" class="flex gap-1">
                                <button id="map-layers-btn" class="button !p-1 text-xs" title="Toggle Layers (Placeholder)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M7.765 1.558a.5.5 0 0 1 .47 0l7.5 4a.5.5 0 0 1 0 .884l-7.5 4a.5.5 0 0 1-.47 0l-7.5-4a.5.5 0 0 1 0-.884z"/><path d="m2.125 8.567-1.86.992a.5.5 0 0 0 0 .884l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.884l-1.86-.992-5.17 2.756a1.5 1.5 0 0 1-1.41 0z"/></svg>
                                </button>
                                <button id="map-toggle-btn" class="button !p-1 text-xs">
                                    <svg id="map-expand-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.42 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"/>
                                    </svg>
                                    </svg>
                                    <svg id="map-minimize-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="hidden" viewBox="0 0 16 16">
                                        <path d="M5.5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1 0-1h3.5V.5a.5.5 0 0 1 .5-.5zM5 11h-4a.5.5 0 0 1 0-1h3.5V6.5a.5.5 0 0 1 1 0v4a.5.5 0 0 1-.5.5zm5.5 0a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 1 0v3.5H11a.5.5 0 0 1 0 1h-4.5zM11 5h4.5a.5.5 0 0 1 0-1H11.5V.5a.5.5 0 0 1-1 0v4a.5.5 0 0 1 .5.5z"/>
                                    </svg>
                                </button>
                            </div>
                        </h3>
                         <canvas id="map-canvas"></canvas>
                     </div>
                     <div id="journal-panel" class="p-3 border border-[var(--main-color-border)] rounded-md bg-black/50 overflow-y-auto h-24 flex-shrink-0">
                         <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2" data-lang="journal_title">JOURNAL</h3>
                         <ul id="journal-list" class="list-none p-0 text-sm"></ul>
                     </div>

                     <!-- Progress Tracking -->
                     <div id="progress-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/50">
                         <h3 class="text-xs font-bold text-cyan-400 mb-2" data-lang="story_progress">Progress</h3>
                         <div id="progress-tracking-container" class="text-xs space-y-2">
                             <!-- Progress bars will be populated here -->
                         </div>
                     </div>

                     <!-- Achievement Previews -->
                     <div id="achievement-hints-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/50">
                         <h3 class="text-xs font-bold text-cyan-400 mb-2" data-lang="achievement_hints">Hints</h3>
                         <div id="achievement-previews-container" class="text-xs space-y-1 max-h-16 overflow-y-auto">
                             <!-- Achievement hints will be populated here -->
                         </div>
                     </div>

                     <div class="p-3 border border-[var(--main-color-border)] rounded-md bg-black/50">
                         <button id="view-progression-btn" class="button w-full" data-lang="progress_btn">PROGRESS</button>
                     </div>
                </div>
            </div>

            <!-- Mobile Scroll Indicator -->
            <div id="mobile-scroll-indicator" class="mobile-scroll-indicator md:hidden">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 0a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 6.293V.5A.5.5 0 0 1 8 0zm0 10a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708l2.147 2.147V10.5A.5.5 0 0 1 8 10z"/>
                </svg>
            </div>

            <div class="mt-2 border-t-2 border-[var(--main-color-border)] pt-2 space-y-2">
                <!-- Context-aware Command Suggestions -->
                <div id="command-suggestions" class="hidden bg-gray-800 border border-gray-600 rounded p-2">
                    <div class="text-xs text-cyan-400 mb-1" data-lang="suggested_actions">Suggested Actions:</div>
                    <div id="suggestion-buttons" class="flex flex-wrap gap-1">
                        <!-- Command suggestion buttons will be populated here -->
                    </div>
                </div>

                <!-- Split Command Input -->
                <div class="flex flex-col gap-2">
                    <!-- Game Command Input -->
                    <div class="flex items-center gap-2 relative">
                        <div id="autocomplete-box" class="hidden"></div>
                        <button id="status-btn" class="button md:hidden" data-lang="status_btn">Status</button>
                        <span class="text-lg text-cyan-400 hidden sm:inline">&gt;</span>
                        <input type="text" id="player-input" class="flex-grow bg-transparent text-lg focus:outline-none border-b border-gray-600 pb-1" 
                               placeholder="Enter game command..." autocomplete="off" autocapitalize="none" spellcheck="false">
                        <div class="input-caret"></div>
                        <button id="mic-btn" class="button !p-2" data-lang-title="mic_tooltip" title="Use Voice Command">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5 3a3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/>
                                <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </button>
                    </div>


                </div>

                <!-- Hotkey Help -->
                <div id="hotkey-help" class="text-xs text-gray-500 hidden">
                    <span data-lang="hotkeys">F1:Help | F2:Inventory | F3:Map | F4:Journal | F5:Save | ESC:Menu</span>
                </div>
            </div>
        </div>


    <div id="modal" class="modal">
        <div id="modal-content" class="modal-content"></div>
    </div>
    
    <script src="script.js"></script></body>
</html>
