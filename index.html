<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- Version: 2025.07.13 - Complete Integration with All Features -->
    <title>SYNAPSE</title>
    <link rel="icon" type="image/png" href="./Icon.png">
    <script>
        // Only load manifest on HTTP/HTTPS protocols to avoid CORS errors
        if (window.location.protocol !== 'file:') {
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = './manifest.json';
            document.head.appendChild(manifestLink);
        }
        
        // Suppress Tailwind CDN production warning
        if (typeof console !== 'undefined' && console.warn) {
            const originalWarn = console.warn;
            console.warn = function(message) {
                if (typeof message === 'string' && message.includes('cdn.tailwindcss.com should not be used in production')) {
                    return; // Suppress this specific warning
                }
                originalWarn.apply(console, arguments);
            };
        }
    </script>
    <script src="https://cdn.tailwindcss.com" onerror="console.error('Failed to load Tailwind CSS')"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=VT323&family=Space+Mono&family=Courier+Prime&display=swap" rel="stylesheet" onerror="console.error('Failed to load Google Fonts')">
    <script src="https://unpkg.com/tone@15.0.4/build/Tone.js" onerror="console.error('Failed to load Tone.js')"></script>
    <link rel="stylesheet" href="style.css">
    <style>
/* === ENHANCED SYNAPSE STYLES === */

/* Additional root variables */
:root {
    --horror-red: #8B0000;
    --blood-red: #DC143C;
    --warning-orange: #FF6347;
    --glitch-purple: #9D00FF;
    --corruption-pink: #FF1493;
    --void-black: #0a0a0a;
    --static-gray: #2a2a2a;
}

/* === HORROR VISUAL EFFECTS === */

/* Screen corruption effects */
@keyframes screen-corruption {
    0% { filter: none; }
    10% { filter: hue-rotate(90deg) saturate(3); }
    20% { filter: invert(1) hue-rotate(180deg); }
    30% { filter: contrast(5) brightness(2); }
    40% { filter: blur(2px) hue-rotate(270deg); }
    50% { filter: none; }
    60% { filter: saturate(0) contrast(10); }
    70% { filter: hue-rotate(45deg) blur(1px); }
    80% { filter: brightness(0.1) contrast(5); }
    90% { filter: invert(1) saturate(0); }
    100% { filter: none; }
}

.corruption-effect {
    animation: screen-corruption 5s infinite;
}

/* Text shake effect */
@keyframes text-shake {
    0%, 100% { transform: translateX(0); }
    10% { transform: translateX(-2px) rotateZ(-1deg); }
    20% { transform: translateX(2px) rotateZ(1deg); }
    30% { transform: translateX(-2px) rotateZ(-1deg); }
    40% { transform: translateX(2px) rotateZ(1deg); }
    50% { transform: translateX(-1px) rotateZ(-0.5deg); }
    60% { transform: translateX(1px) rotateZ(0.5deg); }
    70% { transform: translateX(-1px) rotateZ(-0.5deg); }
    80% { transform: translateX(1px) rotateZ(0.5deg); }
    90% { transform: translateX(0) rotateZ(0); }
}

.text-shake {
    animation: text-shake 0.5s infinite;
}

/* Glitch text effect */
.text-glitch {
    position: relative;
    color: var(--main-color);
}

.text-glitch::before,
.text-glitch::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.text-glitch::before {
    animation: glitch-anim-1 0.5s infinite linear alternate-reverse;
    color: var(--glitch-purple);
    z-index: -1;
}

.text-glitch::after {
    animation: glitch-anim-2 0.5s infinite linear alternate-reverse;
    color: var(--corruption-pink);
    z-index: -2;
}

@keyframes glitch-anim-1 {
    0% { clip-path: inset(20% 0 30% 0); transform: translate(-2px, 2px); }
    25% { clip-path: inset(60% 0 10% 0); transform: translate(2px, -2px); }
    50% { clip-path: inset(10% 0 80% 0); transform: translate(-2px, 0); }
    75% { clip-path: inset(40% 0 40% 0); transform: translate(0, 2px); }
    100% { clip-path: inset(70% 0 20% 0); transform: translate(2px, 0); }
}

@keyframes glitch-anim-2 {
    0% { clip-path: inset(80% 0 10% 0); transform: translate(2px, -2px); }
    25% { clip-path: inset(20% 0 60% 0); transform: translate(-2px, 2px); }
    50% { clip-path: inset(50% 0 30% 0); transform: translate(0, -2px); }
    75% { clip-path: inset(10% 0 70% 0); transform: translate(-2px, 0); }
    100% { clip-path: inset(30% 0 50% 0); transform: translate(0, 2px); }
}

/* Horror modal effect */
.horror-modal {
    animation: horror-pulse 2s infinite;
    box-shadow: 0 0 50px var(--horror-red);
}

@keyframes horror-pulse {
    0%, 100% { box-shadow: 0 0 20px var(--horror-red); }
    50% { box-shadow: 0 0 50px var(--blood-red), 0 0 100px var(--horror-red); }
}

/* Blood drip overlay */
@keyframes blood-drip {
    0% { 
        transform: translateY(-100%);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    100% {
        transform: translateY(100vh);
        opacity: 0.8;
    }
}

.blood-drop {
    position: absolute;
    background: linear-gradient(to bottom, var(--blood-red), transparent);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
}

/* Static noise effect */
.static-overlay {
    background-image: 
        repeating-linear-gradient(0deg,
            transparent,
            transparent 2px,
            rgba(255, 255, 255, 0.03) 2px,
            rgba(255, 255, 255, 0.03) 4px),
        repeating-linear-gradient(90deg,
            transparent,
            transparent 2px,
            rgba(255, 255, 255, 0.03) 2px,
            rgba(255, 255, 255, 0.03) 4px);
    animation: static-shift 0.2s infinite;
}

@keyframes static-shift {
    0% { background-position: 0 0; }
    100% { background-position: 4px 4px; }
}

/* Fracture effect */
.fracture-overlay {
    background-image: 
        linear-gradient(45deg, transparent 30%, rgba(255, 0, 0, 0.1) 30%, rgba(255, 0, 0, 0.1) 31%, transparent 31%),
        linear-gradient(-45deg, transparent 30%, rgba(255, 0, 0, 0.1) 30%, rgba(255, 0, 0, 0.1) 31%, transparent 31%);
    background-size: 20px 20px;
    animation: fracture-spread 3s ease-out forwards;
}

@keyframes fracture-spread {
    0% { clip-path: circle(0% at 50% 50%); }
    100% { clip-path: circle(150% at 50% 50%); }
}

/* Watching eyes effect */
.watching-eye {
    width: 30px;
    height: 15px;
    background: radial-gradient(circle at center, red 30%, black 31%);
    border-radius: 50%;
    position: absolute;
    animation: eye-blink 5s infinite;
}

@keyframes eye-blink {
    0%, 90%, 100% { transform: scaleY(1); }
    95% { transform: scaleY(0.1); }
}

/* === UI ENHANCEMENTS === */

/* Breadcrumb navigation */
#breadcrumb-nav {
    padding: 0.5rem;
    background: rgba(0, 0, 0, 0.5);
    border-bottom: 1px solid var(--main-color-border);
    font-size: 0.875rem;
}

#breadcrumb-nav span:hover {
    text-shadow: 0 0 5px var(--main-color);
}

/* Room history panel */
.room-history-item {
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
}

.room-history-item:hover {
    border-left-color: var(--main-color);
    transform: translateX(5px);
}

/* Interactive minimap */
#map-canvas {
    transition: transform 0.3s ease;
}

#map-canvas.zoomed {
    transform: scale(1.5);
}

.map-marker {
    cursor: pointer;
    transition: all 0.2s ease;
}

.map-marker:hover {
    transform: scale(1.2);
    filter: brightness(1.5);
}

/* Command suggestions */
#command-suggestions {
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    background: rgba(13, 13, 13, 0.95);
    border: 1px solid var(--main-color-border);
    border-bottom: none;
    max-height: 200px;
    overflow-y: auto;
    z-index: 100;
}

.suggestion-item {
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-bottom: 1px solid rgba(0, 255, 65, 0.1);
}

.suggestion-item:hover,
.suggestion-item.selected {
    background: var(--main-color-faded);
    color: white;
}

/* Drag & drop inventory */
.inventory-item {
    cursor: move;
    padding: 0.5rem;
    margin: 0.25rem 0;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid var(--main-color-border);
    border-radius: 0.25rem;
    transition: all 0.3s ease;
}

.inventory-item:hover {
    background: var(--main-color-faded);
    transform: translateX(5px);
}

.inventory-item.dragging {
    opacity: 0.5;
    transform: scale(1.05);
}

.inventory-drop-zone {
    min-height: 50px;
    border: 2px dashed var(--main-color-border);
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--main-color);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.inventory-drop-zone.active {
    opacity: 1;
}

/* Progress indicators */
.progress-bar {
    height: 4px;
    background: var(--static-gray);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--main-color) 0%, var(--main-color-glow) 100%);
    transition: width 0.3s ease;
    box-shadow: 0 0 10px var(--main-color-glow);
}

.progress-pulse {
    animation: progress-pulse 2s infinite;
}

@keyframes progress-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Achievement notifications */
.achievement-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: var(--void-black);
    border: 2px solid gold;
    padding: 2rem;
    border-radius: 0.5rem;
    text-align: center;
    z-index: 1000;
    animation: achievement-appear 0.5s ease-out forwards;
}

@keyframes achievement-appear {
    0% { transform: translate(-50%, -50%) scale(0) rotate(180deg); }
    50% { transform: translate(-50%, -50%) scale(1.1) rotate(0deg); }
    100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
}

.achievement-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    animation: achievement-glow 2s infinite;
}

@keyframes achievement-glow {
    0%, 100% { filter: drop-shadow(0 0 10px gold); }
    50% { filter: drop-shadow(0 0 20px gold) drop-shadow(0 0 30px orange); }
}

/* Note-taking interface */
.notepad-container {
    position: relative;
}

.notepad-container textarea {
    font-family: 'Courier Prime', monospace;
    resize: vertical;
    min-height: 200px;
}

.notepad-tools {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    display: flex;
    gap: 0.5rem;
}

/* Bookmark system */
.bookmark-item {
    background: linear-gradient(135deg, rgba(0, 255, 65, 0.1) 0%, transparent 100%);
    border-left: 3px solid var(--main-color);
    padding: 1rem;
    margin: 0.5rem 0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.bookmark-item:hover {
    background: linear-gradient(135deg, rgba(0, 255, 65, 0.2) 0%, rgba(0, 255, 65, 0.1) 100%);
    transform: translateX(5px);
}

/* Session statistics */
.stat-item {
    background: rgba(0, 0, 0, 0.5);
    padding: 1rem;
    border-radius: 0.5rem;
    border: 1px solid var(--main-color-border);
}

.stat-item span:first-child {
    display: block;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
}

.stat-item span:last-child {
    display: block;
    font-size: 1.5rem;
}

/* === ACCESSIBILITY ENHANCEMENTS === */

/* High contrast mode */
.high-contrast {
    --main-color: #00ff00;
    --main-color-border: #00ff00;
    background: black !important;
    color: white !important;
}

.high-contrast * {
    border-color: white !important;
    outline: 1px solid white !important;
}

.high-contrast button {
    background: black !important;
    color: white !important;
    border: 2px solid white !important;
}

.high-contrast button:hover {
    background: white !important;
    color: black !important;
}

/* Reduced motion */
.reduced-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

/* Colorblind modes */
.protanopia {
    filter: url('#protanopia-filter');
}

.deuteranopia {
    filter: url('#deuteranopia-filter');
}

.tritanopia {
    filter: url('#tritanopia-filter');
}

/* Font size adjustments */
.text-xs { font-size: 0.75rem; }
.text-sm { font-size: 0.875rem; }
.text-base { font-size: 1rem; }
.text-lg { font-size: 1.125rem; }
.text-xl { font-size: 1.25rem; }

/* Line spacing */
.line-height-compact { line-height: 1.2; }
.line-height-normal { line-height: 1.5; }
.line-height-relaxed { line-height: 1.8; }
.line-height-double { line-height: 2; }

/* Focus indicators */
*:focus {
    outline: 2px solid var(--main-color);
    outline-offset: 2px;
}

.keyboard-nav *:focus {
    outline: 3px solid var(--main-color);
    outline-offset: 4px;
    box-shadow: 0 0 10px var(--main-color);
}

/* Screen reader only */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* === MOBILE OPTIMIZATIONS === */

@media (max-width: 768px) {
    /* Touch-friendly controls */
    .button {
        min-height: 44px;
        min-width: 44px;
    }
    
    /* Mobile inventory */
    .inventory-item {
        padding: 1rem;
        font-size: 1.1rem;
    }
    
    /* Mobile command input */
    #player-input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 1rem;
    }
    
    /* Mobile map */
    #map-panel.fullscreen {
        padding: 0;
    }
    
    #map-canvas {
        touch-action: pan-x pan-y;
    }
    
    /* Mobile notifications */
    .notification {
        left: 10px;
        right: 10px;
        max-width: calc(100vw - 20px);
    }
}

/* === DYNAMIC THEMES === */

/* Matrix theme */
.theme-matrix {
    --main-color: #00ff00;
    --main-color-faded: rgba(0, 255, 0, 0.1);
    --main-color-border: rgba(0, 255, 0, 0.8);
    --main-color-shadow: rgba(0, 255, 0, 0.5);
    --main-color-glow: rgba(0, 255, 0, 0.7);
    background: black;
    color: #00ff00;
}

/* Blood theme */
.theme-blood {
    --main-color: #ff0000;
    --main-color-faded: rgba(255, 0, 0, 0.1);
    --main-color-border: rgba(255, 0, 0, 0.8);
    --main-color-shadow: rgba(255, 0, 0, 0.5);
    --main-color-glow: rgba(255, 0, 0, 0.7);
    background: #1a0000;
    color: #ff6666;
}

/* Void theme */
.theme-void {
    --main-color: #9D00FF;
    --main-color-faded: rgba(157, 0, 255, 0.1);
    --main-color-border: rgba(157, 0, 255, 0.8);
    --main-color-shadow: rgba(157, 0, 255, 0.5);
    --main-color-glow: rgba(157, 0, 255, 0.7);
    background: #0a0015;
    color: #cc99ff;
}

/* === ADVANCED VISUAL EFFECTS === */

/* Parallax background */
.parallax-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 120%;
    height: 120%;
    pointer-events: none;
}

.parallax-layer-1 {
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="%23003300" opacity="0.5"/></svg>');
    background-size: 100px 100px;
    animation: parallax-drift-1 60s linear infinite;
}

.parallax-layer-2 {
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect x="50" y="50" width="2" height="2" fill="%23006600" opacity="0.3"/></svg>');
    background-size: 200px 200px;
    animation: parallax-drift-2 45s linear infinite;
}

@keyframes parallax-drift-1 {
    0% { transform: translate(0, 0); }
    100% { transform: translate(-100px, -100px); }
}

@keyframes parallax-drift-2 {
    0% { transform: translate(0, 0); }
    100% { transform: translate(50px, -50px); }
}

/* Reality distortion effect */
.reality-distortion {
    animation: reality-warp 10s infinite;
}

@keyframes reality-warp {
    0%, 100% { filter: none; }
    25% { filter: blur(1px) contrast(1.2); }
    50% { filter: blur(2px) saturate(0.8) hue-rotate(10deg); }
    75% { filter: blur(1px) brightness(1.1) hue-rotate(-10deg); }
}

/* Memory glitch effect */
.memory-glitch {
    position: relative;
    overflow: hidden;
}

.memory-glitch::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    animation: memory-sweep 3s infinite;
}

@keyframes memory-sweep {
    0% { left: -100%; }
    100% { left: 100%; }
}

/* Pulse effect for important elements */
.pulse-important {
    animation: pulse-glow 2s infinite;
}

@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 0 0 5px var(--main-color);
    }
    50% {
        box-shadow: 0 0 20px var(--main-color), 0 0 30px var(--main-color-glow);
    }
}

/* Loading states */
.skeleton-loader {
    background: linear-gradient(90deg, var(--static-gray) 25%, var(--main-color-faded) 50%, var(--static-gray) 75%);
    background-size: 200% 100%;
    animation: skeleton-loading 1.5s infinite;
}

@keyframes skeleton-loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Color filter SVG definitions */
</style>
<svg style="display: none;">
    <defs>
        <filter id="protanopia-filter">
            <feColorMatrix values="0.567, 0.433, 0, 0, 0
                                 0.558, 0.442, 0, 0, 0
                                 0, 0.242, 0.758, 0, 0
                                 0, 0, 0, 1, 0"/>
        </filter>
        <filter id="deuteranopia-filter">
            <feColorMatrix values="0.625, 0.375, 0, 0, 0
                                 0.7, 0.3, 0, 0, 0
                                 0, 0.3, 0.7, 0, 0
                                 0, 0, 0, 1, 0"/>
        </filter>
        <filter id="tritanopia-filter">
            <feColorMatrix values="0.95, 0.05, 0, 0, 0
                                 0, 0.733, 0.267, 0, 0
                                 0, 0.183, 0.817, 0, 0
                                 0, 0, 0, 1, 0"/>
        </filter>
    </defs>
</svg>
</head>
<body class="bg-black overflow-hidden">
    <canvas id="background-canvas"></canvas>
    <div id="error-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; background: rgba(0,0,0,0.9); display: none;"></div>
    <div id="app-container" class="w-screen h-screen bg-black/75 p-1 xs:p-2 sm:p-3 lg:p-4 flex flex-col">
        
        <div id="start-screen" class="flex flex-col items-center justify-center text-center h-full">
            <div class="w-full h-full flex flex-col items-center justify-center bg-black bg-opacity-60">
                <!-- Header for lang buttons -->
                <div class="w-full flex justify-end p-2">
                    <div id="lang-buttons" class="flex gap-2">
                        <button id="lang-en-btn" data-lang="en_lang_short" data-text="EN" class="button text-xs !px-2 !py-1 btn-drip">EN</button>
                        <button id="lang-sv-btn" data-lang="sv_lang_short" data-text="SV" class="button text-xs !px-2 !py-1 opacity-50 btn-drip">SV</button>
                    </div>
                </div>

                <!-- Main content flex-grow -->
                <div class="flex-grow flex flex-col items-center justify-center text-center px-4 w-full">
                    <div class="title-wrapper -mt-26 sm:-mt-40">
                        <h1 id="game-title" data-text="SYNAPSE" class="text-50xl md:text-64xl lg:text-78xl font-bold title-slasher mb-2">SYNAPSE</h1>
                        <h2 data-text="ROOT ACCESS DENIED" class="text-38xl-2 md:text-22xl lg:text-14xl font-mono text-red-500 tracking-wider subtitle-slasher -mt -1 mb-1">ROOT ACCESS DENIED</h2>
                    </div>
                    <div id="intro-text-container" class="max-w-4xl text-sm md:text-base text-white mt-8 sm:mt-12"></div>
                    <div id="start-options" class="mt-10 flex flex-wrap justify-center gap-4">
                        <button id="new-game-btn" data-lang="new_game" data-text="New Game" class="button btn-glow btn-drip">New Game</button>
                        <button id="load-game-btn" data-lang="load_game" data-text="Load Game" class="button btn-glow btn-drip">Load Game</button>
                    </div>
                </div>

                <!-- Footer for other buttons -->
                <div class="w-full flex flex-wrap justify-between items-center p-2 gap-2">
                    <button id="start-settings-btn" data-lang="settings_btn" data-text="Settings" class="button btn-glow btn-drip">Settings</button>
                    <button id="view-features-btn" data-lang="understand_game" data-text="Understand the Game" class="button btn-glow btn-drip">Understand the Game</button>
                </div>
            </div>
        </div>

        <div id="player-setup" class="hidden flex flex-col items-center justify-center text-center h-full">
             <div class="w-full h-full flex flex-col items-center justify-center bg-black bg-opacity-60">
                <!-- Header for lang buttons -->
                <div class="w-full flex justify-end p-2">
                    <div id="setup-lang-buttons" class="flex gap-2">
                        <button data-lang="en_lang_short" data-text="EN" class="button text-xs !px-2 !py-1 btn-drip">EN</button>
                        <button data-lang="sv_lang_short" data-text="SV" class="button text-xs !px-2 !py-1 opacity-50 btn-drip">SV</button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="flex-grow flex flex-col items-center justify-center text-center px-4 w-full">
                    <div class="title-wrapper -mt-8 sm:-mt-12">
                        <h1 id="setup-game-title" data-text="SYNAPSE" class="text-6xl sm:text-7xl md:text-8xl font-bold title-slasher mb-2">SYNAPSE</h1>
                        <h2 data-text="ROOT ACCESS DENIED" class="text-2xl sm:text-3xl md:text-4xl font-mono text-red-500 tracking-wider subtitle-slasher -mt-2 mb-4">ROOT ACCESS DENIED</h2>
                    </div>
                    <div class="max-w-4xl text-sm md:text-base text-white mt-6 sm:mt-8">
                        <p class="mb-3" data-lang="select_difficulty">Select difficulty:</p>
                        <div class="flex gap-2 sm:gap-3 mb-4 justify-center flex-wrap">
                            <button class="difficulty-btn button" data-difficulty="Easy" data-lang="easy">Easy</button>
                            <button class="difficulty-btn button button-primary" data-difficulty="Normal" data-lang="normal">Normal</button>
                            <button class="difficulty-btn button" data-difficulty="Hard" data-lang="hard">Hard</button>
                        </div>
                        <input type="text" id="player-name" data-lang-placeholder="enter_name_placeholder" placeholder="Enter your name" class="bg-transparent border-b-2 border-[var(--main-color)] text-center w-48 sm:w-64 mb-3 focus:outline-none p-1 mx-auto block text-sm sm:text-base">
                        <input type="text" id="player-phobia" placeholder="Enter your phobia (e.g., darkness, isolation, blood, etc.) or leave blank for random" class="bg-transparent border-b-2 border-[var(--main-color)] text-center w-48 sm:w-64 mb-3 focus:outline-none p-1 mx-auto block text-sm sm:text-base">
                        <div class="flex items-center gap-2 mb-3 justify-center flex-wrap">
                            
                        <div id="ability-display" class="text-center text-cyan-400 min-h-[2.5rem] mb-3 p-2 border border-cyan-400/30 rounded-md bg-black/50 w-full max-w-md mx-auto flex items-center justify-center text-sm"></div>
                    </div>
                    <div class="mt-4 sm:mt-6 flex flex-wrap justify-center gap-2 sm:gap-4">
                       <button id="back-to-start-btn" data-lang="go_back_btn" data-text="Go Back" class="button btn-glow btn-drip">Go Back</button>
                       <button id="start-game-btn" class="button button-primary btn-glow btn-drip" data-lang="begin">Begin</button>
                    </div>
                </div>

                <!-- Footer -->
                 <div class="w-full flex flex-wrap justify-between items-center p-2 gap-2">
                    <button id="setup-settings-btn" data-lang="settings_btn" data-text="Settings" class="button btn-glow btn-drip">Settings</button>
                    <button id="setup-features-btn" data-lang="understand_game" data-text="Understand the Game" class="button btn-glow btn-drip">Understand the Game</button>
                 </div>
            </div>
        </div>


        <div id="game-screen" class="hidden flex flex-col h-full overflow-hidden">
            <!-- Breadcrumb Navigation -->
            <div id="breadcrumb-nav" class="w-full"></div>
            
            <!-- AI Personality & Dialogue System -->
            <div id="ai-personality-bar" class="w-full flex items-center justify-between p-2 bg-black/80 border-b border-[var(--main-color-border)]">
                <div id="ai-personality-state" class="font-mono text-base text-cyan-400">AI: Friendly</div>
                <div id="ai-awareness-bar" class="flex items-center gap-2">
                    <span class="text-xs text-gray-400">Awareness</span>
                    <div class="w-32 h-2 bg-gray-700 rounded-full overflow-hidden">
                        <div id="awareness-progress" class="h-2 bg-cyan-400" style="width: 0%"></div>
                    </div>
                    <span id="awareness-value" class="text-xs text-cyan-400">0</span>
                </div>
                <div id="ai-audio-visualizer" class="w-24 h-4 bg-black/60 rounded"></div>
            </div>

            <div class="flex-grow flex flex-row gap-2 md:gap-4 min-h-0 h-full">
                <!-- Main Narrative & Command Area -->
                <div class="w-full md:w-2/3 flex flex-col min-h-0 flex-shrink">
                    <div id="game-output" class="flex-grow p-2 border border-[var(--main-color-border)] rounded-md overflow-y-auto mb-2 bg-black/60 min-h-0 font-mono text-white"></div>
                    <div id="dialogue-options" class="flex flex-wrap gap-2 justify-center p-2 flex-shrink-0"></div>
                    <!-- Skill Tree & XP -->
                    <div id="skill-tree-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/50 mt-2">
                        <h3 class="font-bold text-cyan-400 mb-1">Skill Tree</h3>
                        <div id="skill-tree" class="flex flex-wrap gap-2"></div>
                        <div id="xp-bar" class="w-full h-2 bg-gray-700 rounded-full overflow-hidden mt-1">
                            <div id="xp-progress" class="h-2 bg-green-400" style="width: 0%"></div>
                        </div>
                        <div id="xp-value" class="text-xs text-green-400 mt-1">XP: 0</div>
                    </div>
                    <!-- Phobia System -->
                    <div id="phobia-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/50 mt-2">
                        <h3 class="font-bold text-red-400 mb-1">Phobias</h3>
                        <div id="phobia-list" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>

                <!-- Side Panel: Stats, Inventory, Map, Journal, Achievements -->
                <div id="side-panel" class="w-1/3 flex flex-col gap-2 min-h-0 overflow-hidden">
                    <!-- Stats & Character -->
                    <div id="stats-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/60 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 text-base text-cyan-400" data-lang="stats_title">STATS</h3>
                        <div id="player-name-display" class="text-xs"></div>
                        <div id="player-backstory-display" class="text-xs"></div>
                        <div id="difficulty-display" class="text-xs"></div>
                        <div id="sanity-display" class="text-xs"><span data-lang="sanity">Sanity</span>: <span id="sanity-value">100</span></div>
                        <div id="awareness-display" class="text-xs"><span data-lang="awareness">Awareness</span>: <span id="awareness-stat">0</span></div>
                        <div id="tone-display" class="text-xs"><span data-lang="tone">Tone</span>: <span id="tone-value">Friendly</span></div>
                        <div id="turn-display" class="text-xs"><span data-lang="turn">Turn</span>: <span id="turn-value">0</span></div>
                        <div id="xp-stat" class="text-xs"><span>XP</span>: <span id="xp-stat-value">0</span></div>
                    </div>
                    <!-- Inventory -->
                    <div id="inventory-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/60 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 text-base text-yellow-400" data-lang="inventory_title">INVENTORY <span id="inventory-weight">(0/5)</span></h3>
                        <ul id="inventory-list" class="list-none p-0 text-xs"></ul>
                    </div>
                    <!-- Objectives -->
                    <div id="objectives-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/60 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 text-base text-green-400" data-lang="objectives_title">OBJECTIVES</h3>
                        <ul id="objectives-list" class="list-none p-0 text-xs"></ul>
                    </div>
                    <!-- Map -->
                    <div id="map-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/60 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 text-base text-blue-400" data-lang="map_title">MAP</h3>
                        <canvas id="map-canvas" class="w-full h-32 bg-black/80 rounded mb-2"></canvas>
                        <div id="map-controls" class="flex gap-1 mb-1">
                            <button id="map-layers-btn" class="button !p-1 text-xs" title="Toggle Layers">Layers</button>
                            <button id="map-toggle-btn" class="button !p-1 text-xs">Expand</button>
                        </div>
                    </div>
                    <!-- Journal -->
                    <div id="journal-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/60 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 text-base text-orange-400" data-lang="journal_title">JOURNAL</h3>
                        <ul id="journal-list" class="list-none p-0 text-xs"></ul>
                    </div>
                    <!-- Achievements -->
                    <div id="achievements-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/60 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 text-base text-pink-400" data-lang="achievements_title">ACHIEVEMENTS</h3>
                        <ul id="achievements-list" class="list-none p-0 text-xs"></ul>
                    </div>
                    <!-- Settings & Accessibility -->
                    <div id="settings-panel" class="p-2 border border-[var(--main-color-border)] rounded-md bg-black/60 flex-shrink-0">
                        <h3 class="font-bold border-b border-[var(--main-color-border)] mb-2 text-base text-white" data-lang="settings_title">SETTINGS</h3>
                        <div id="settings-controls" class="flex flex-col gap-2"></div>
                    </div>
                </div>
            </div>

            <!-- Command Input & Accessibility -->
            <div class="mt-1 flex items-center border-t-2 border-[var(--main-color-border)] pt-1 gap-1 relative flex-shrink-0 bg-black/80">
                <div id="command-suggestions" class="hidden"></div>
                <div id="autocomplete-box" class="hidden"></div>
                <button id="status-btn" class="button text-xs !px-2 !py-1" data-lang="status_btn">Status</button>
                <span class="text-lg md:text-xl hidden sm:inline">&gt;</span>
                <input type="text" id="player-input" class="flex-grow bg-transparent text-sm md:text-lg ml-1 md:ml-2 focus:outline-none min-w-0" autocomplete="off" autocapitalize="none" spellcheck="false">
                <div class="input-caret"></div>
                <button id="mic-btn" class="button !p-1 md:!p-2 ml-1 md:ml-2 flex-shrink-0" data-lang-title="mic_tooltip" title="Use Voice Command">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5 3a3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/>
                        <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                    </svg>
                </button>
                <button id="accessibility-btn" class="button text-xs ml-2" title="Accessibility Options">A11y</button>
            </div>

            <!-- Overlays & Modals for Advanced Systems -->
            <div id="overlay-container" class="fixed inset-0 z-50 pointer-events-none">
                <!-- Dynamic overlays for horror effects, memory corruption, temporal distortion, etc. -->
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div id="modal-content" class="modal-content"></div>
    </div>
    
    <!-- Load all JavaScript modules -->
    <script src="./debug.js"></script>
    <script src="./simple-init.js"></script>
    <script src="./robust-init.js"></script>
</body>
</html>